<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>पूरग्रस्त माहिती फॉर्म</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 20px auto; padding: 30px; background-color: #ffffff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; }
        .header h2 { font-size: 1rem; font-weight: 500; color: #555; margin: 0 0 10px 0; }
        .header h1 { font-size: 1.5rem; font-weight: 700; color: #0056b3; margin: 0; }
        .form-group { margin-bottom: 20px; position: relative; } /* Autocomplete साठी position: relative आवश्यक */
        label, legend { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; color: #333; }
        input[type="text"], input[type="tel"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
        button[type="submit"] { width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button[type="submit"]:disabled { background-color: #a0cfff; cursor: wait; }
        #status { text-align: center; margin-top: 20px; font-weight: bold; font-size: 1.1rem; }
        #loader { text-align: center; font-size: 1.2rem; padding: 40px; color: #007bff; }
        .hidden { display: none; }
        
        /* ******** Autocomplete साठी नवीन CSS ******** */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff; 
            border-bottom: 1px solid #d4d4d4; 
        }
        .autocomplete-items div:hover {
            background-color: #e9e9e9; 
        }
        .autocomplete-active {
            background-color: DodgerBlue !important; 
            color: #ffffff; 
        }
        /* ****************************************** */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>पर्याय सामाजिक संस्था, सावित्रीबाई फुले म्युच्युअल बेनिफिट ट्रस्ट आणि अनिक फायनान्सीयल सर्व्हिसेस प्रा. लि. यांचे संयुक्त विद्यमाने</h2>
            <h1>धाराशिव जिल्हा – सप्टेंबर 2025 मधील अतिवृष्टीमुळे झालेल्या नुकसानीबाबत माहिती ✅</h1>
        </div>
        <div id="loader">ग्राहकांची माहिती लोड होत आहे... कृपया प्रतीक्षा करा.</div>
        <form id="damageForm" class="hidden" autocomplete="off">
            <!-- ******** <select> ऐवजी <input> वापरला आहे ******** -->
            <div class="form-group">
                <label for="customerName">आपले नांव शोधा</label>
                <input type="text" id="customerName" name="customerName" placeholder="नावाचे पहिले काही अक्षर टाइप करा..." required>
            </div>
            <!-- ********************************************** -->

            <div class="form-group"> <label for="loanNumber">आपला लोन नंबर</label> <input type="text" id="loanNumber" name="loanNumber" readonly> </div>
            <div class="form-group"> <label for="village">गांव</label> <input type="text" id="village" name="village" readonly> </div>
            <div class="form-group"> <label for="branch">शाखा</label> <input type="text" id="branch" name="branch" readonly> </div>
            <hr>
            <div class="form-group"> <label for="mobile">मोबाईल क्रमांक</label> <input type="tel" id="mobile" name="mobile" required> </div>
            <div class="form-group"> <fieldset> <legend>झालेल्या नुकसानीचा प्रकार...</legend> <!-- सर्व चेकबॉक्स जसे आहेत तसेच राहतील --> <div class="checkbox-group"> <div><input type="checkbox" id="damage1" name="damageType" value="घराची पडझड"><label for="damage1">घराची पडझड</label></div> <div><input type="checkbox" id="damage2" name="damageType" value="पशुधन / जनावरे मृत्यू"><label for="damage2">पशुधन / जनावरे मृत्यू</label></div> <div><input type="checkbox" id="damage3" name="damageType" value="शेती वाहून गेली / खरवडली"><label for="damage3">शेती वाहून गेली / खरवडली</label></div> <div><input type="checkbox" id="damage4" name="damageType" value="पिकाचे नुकसान"><label for="damage4">पिकाचे नुकसान</label></div> <div><input type="checkbox" id="damage5" name="damageType" value="मनुष्यहानी"><label for="damage5">मनुष्यहानी</label></div> <div><input type="checkbox" id="damage6" name="damageType" value="विहीरीत गाळ भरला"><label for="damage6">विहीरीत गाळ भरला</label></div> <div><input type="checkbox" id="damage7" name="damageType" value="व्यवसायाचे नुकसान"><label for="damage7">व्यवसायाचे नुकसान</label></div> <div><input type="checkbox" id="damage8" name="damageType" value="शेती साहित्याचे नुकसान"><label for="damage8">शेती साहित्याचे नुकसान</label></div> <div><input type="checkbox" id="damage9" name="damageType" value="अन्नधान्य नुकसान"><label for="damage9">अन्नधान्य नुकसान</label></div> <div><input type="checkbox" id="damage10" name="damageType" value="मुलांचे शालेय साहित्य नुकसान"><label for="damage10">मुलांचे शालेय साहित्य नुकसान</label></div> </div> </fieldset> </div>
            <div class="form-group"> <label for="notes">काही विशेष नोट असल्यास मांडा</label> <textarea id="notes" name="notes" rows="4"></textarea> </div>
            <div class="form-group"> <button type="submit" id="submitBtn">माहिती सबमिट करा</button> </div>
            <div id="status"></div>
        </form>
    </div>

    <script>
        // !!!!!! इथे तुमची सर्वात नवीन URL पेस्ट करा !!!!!!
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyx2ElRWHzehTy9buklzfOZtry5MNvqstRx3aS2uDPwWTFdzQfuj5e2or1X-kJm_MjQ/exec"; 

        const form = document.getElementById('damageForm');
        const loader = document.getElementById('loader');
        const customerNameInput = document.getElementById('customerName');
        const loanNumberInput = document.getElementById('loanNumber');
        const villageInput = document.getElementById('village');
        const branchInput = document.getElementById('branch');
        const submitBtn = document.getElementById('submitBtn');
        const statusDiv = document.getElementById('status');
        let customerData = [];

        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const response = await fetch(SCRIPT_URL);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                customerData = await response.json();
                loader.classList.add('hidden');
                form.classList.remove('hidden');
                // Autocomplete फंक्शन सुरू करा
                autocomplete(customerNameInput, customerData.map(c => c.name));
            } catch (error) {
                loader.textContent = `माहिती लोड करण्यात त्रुटी आली. कृपया Apps Script URL तपासा आणि पेज रीफ्रेश करा.`;
                loader.style.color = 'red';
            }
        });

        // ******** Autocomplete साठी नवीन JavaScript कोड ********
        function autocomplete(inp, arr) {
            let currentFocus;
            inp.addEventListener("input", function(e) {
                let a, b, i, val = this.value;
                closeAllLists();
                if (!val) { return false; }
                currentFocus = -1;
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(a);
                for (i = 0; i < arr.length; i++) {
                    if (arr[i].toUpperCase().includes(val.toUpperCase())) {
                        b = document.createElement("DIV");
                        b.innerHTML = "<strong>" + arr[i].substr(0, arr[i].toUpperCase().indexOf(val.toUpperCase())) + "</strong>";
                        b.innerHTML += arr[i].substr(arr[i].toUpperCase().indexOf(val.toUpperCase()), val.length);
                        b.innerHTML += arr[i].substr(arr[i].toUpperCase().indexOf(val.toUpperCase()) + val.length);
                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        b.addEventListener("click", function(e) {
                            inp.value = this.getElementsByTagName("input")[0].value;
                            fillCustomerDetails(inp.value);
                            closeAllLists();
                        });
                        a.appendChild(b);
                    }
                }
            });

            function closeAllLists(elmnt) {
                const x = document.getElementsByClassName("autocomplete-items");
                for (let i = 0; i < x.length; i++) {
                    if (elmnt != x[i] && elmnt != inp) {
                        x[i].parentNode.removeChild(x[i]);
                    }
                }
            }

            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
            });
        }

        function fillCustomerDetails(name) {
            const selectedCustomer = customerData.find(c => c.name === name);
            if (selectedCustomer) {
                loanNumberInput.value = selectedCustomer.loanNumber;
                villageInput.value = selectedCustomer.village;
                branchInput.value = selectedCustomer.branch;
            } else {
                loanNumberInput.value = ''; villageInput.value = ''; branchInput.value = '';
            }
        }
        // **********************************************

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // ખાતરી करा की निवडलेले नाव डेटाबेसमधील आहे
            const isValidCustomer = customerData.some(c => c.name === customerNameInput.value);
            if (!isValidCustomer) {
                statusDiv.textContent = 'कृपया सूचीमधून योग्य ग्राहक निवडा.';
                statusDiv.style.color = 'orange';
                return;
            }
            
            submitBtn.disabled = true;
            statusDiv.textContent = 'माहिती सेव्ह होत आहे...';
            statusDiv.style.color = '#333';

            const formData = {
                name: customerNameInput.value,
                loanNumber: loanNumberInput.value,
                village: villageInput.value,
                branch: branchInput.value,
                mobile: document.getElementById('mobile').value,
                damages: Array.from(document.querySelectorAll('input[name="damageType"]:checked')).map(cb => cb.value),
                notes: document.getElementById('notes').value,
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(formData)
                });
                const result = await response.json();
                if (result.status === "Success") {
                    statusDiv.textContent = 'आपली माहिती यशस्वीरित्या जतन झाली आहे!';
                    statusDiv.style.color = 'green';
                    form.reset();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                statusDiv.textContent = `माहिती सबमिट करताना त्रुटी: ${error.message}`;
                statusDiv.style.color = 'red';
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
